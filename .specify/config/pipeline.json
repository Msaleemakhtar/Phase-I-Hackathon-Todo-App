{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "SDD Pipeline Configuration",
  "description": "Configuration for the Spec-Driven Development pipeline orchestrator",
  "type": "object",
  "properties": {
    "pipeline": {
      "type": "object",
      "description": "Pipeline behavior settings",
      "properties": {
        "skip_phases": {
          "type": "array",
          "description": "Phases to automatically skip (will not run even if requested)",
          "items": {
            "type": "string",
            "enum": ["validation", "clarification", "planning", "adr", "tasks", "implementation"]
          },
          "default": [],
          "examples": [["adr"], ["clarification", "adr"]]
        },
        "auto_approve_phases": {
          "type": "array",
          "description": "Phases that proceed automatically without user approval gates",
          "items": {
            "type": "string",
            "enum": ["validation", "clarification", "planning", "adr", "tasks", "implementation"]
          },
          "default": [],
          "examples": [["validation"], ["validation", "clarification"]]
        },
        "require_approval_phases": {
          "type": "array",
          "description": "Phases that ALWAYS require user approval (overrides auto_approve)",
          "items": {
            "type": "string",
            "enum": ["validation", "clarification", "planning", "adr", "tasks", "implementation"]
          },
          "default": ["implementation"],
          "examples": [["implementation"], ["planning", "implementation"]]
        },
        "default_starting_phase": {
          "type": "string",
          "description": "Default phase to start from when /sp.autopilot is run without --resume",
          "enum": ["validation", "clarification", "planning", "adr", "tasks", "implementation"],
          "default": "validation"
        }
      }
    },
    "validation": {
      "type": "object",
      "description": "Spec validation configuration",
      "properties": {
        "checklist_items": {
          "type": "array",
          "description": "Custom checklist items for spec validation (overrides default 6-item checklist)",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique identifier for this checklist item"
              },
              "description": {
                "type": "string",
                "description": "Human-readable description of the requirement"
              },
              "severity": {
                "type": "string",
                "enum": ["block", "warn", "info"],
                "description": "Severity level: block (must fix), warn (should fix), info (nice to have)"
              }
            },
            "required": ["id", "description", "severity"]
          },
          "default": [
            {
              "id": "intent_clarity",
              "description": "Intent is clear (someone unfamiliar can understand the goal)",
              "severity": "block"
            },
            {
              "id": "testable_constraints",
              "description": "Constraints are specific and testable (not vague)",
              "severity": "block"
            },
            {
              "id": "smart_evals",
              "description": "Success Evals are SMART (Specific, Measurable, Achievable, Relevant, Time-bound)",
              "severity": "warn"
            },
            {
              "id": "explicit_non_goals",
              "description": "Non-Goals are explicit (prevents scope creep)",
              "severity": "warn"
            },
            {
              "id": "no_implementation_leakage",
              "description": "No 'how' leaked in (describes what, not how to build)",
              "severity": "block"
            },
            {
              "id": "readability",
              "description": "Written clearly enough that another person could write from it",
              "severity": "block"
            }
          ]
        },
        "forbidden_terms": {
          "type": "array",
          "description": "Terms that indicate implementation leakage (should not appear in spec)",
          "items": {
            "type": "string"
          },
          "default": [
            "API", "endpoint", "REST", "GraphQL", "database", "schema", "table",
            "React", "Vue", "Angular", "Python", "JavaScript", "framework",
            "library", "package", "module", "class", "function", "method",
            "Redis", "PostgreSQL", "MongoDB", "MySQL", "cache", "queue"
          ]
        },
        "max_clarifications": {
          "type": "integer",
          "description": "Maximum number of [NEEDS CLARIFICATION] markers allowed in spec",
          "default": 3,
          "minimum": 1,
          "maximum": 10
        },
        "block_threshold": {
          "type": "integer",
          "description": "Number of failed 'block' severity items that stops the pipeline",
          "default": 3,
          "minimum": 1
        }
      }
    },
    "clarification": {
      "type": "object",
      "description": "Clarification phase configuration",
      "properties": {
        "auto_trigger": {
          "type": "boolean",
          "description": "Automatically run clarification if validation detects issues",
          "default": true
        },
        "questions": {
          "type": "array",
          "description": "Standard clarification questions to ask (in order)",
          "items": {
            "type": "string"
          },
          "default": [
            "Is the feature scope clear?",
            "Would a planner know what feature structure to design?",
            "Are there any remaining ambiguities?",
            "Is this specification ready for the planning phase?"
          ]
        }
      }
    },
    "adr": {
      "type": "object",
      "description": "ADR detection configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable ADR detection phase",
          "default": true
        },
        "significance_thresholds": {
          "type": "object",
          "description": "Thresholds for determining if a decision is ADR-worthy",
          "properties": {
            "impact_score": {
              "type": "number",
              "description": "Minimum impact score (0-10) for ADR-worthy decision",
              "default": 7.0,
              "minimum": 0,
              "maximum": 10
            },
            "min_alternatives": {
              "type": "integer",
              "description": "Minimum number of alternatives considered",
              "default": 2,
              "minimum": 1
            },
            "scope_score": {
              "type": "number",
              "description": "Minimum scope score (0-10) for cross-cutting impact",
              "default": 6.0,
              "minimum": 0,
              "maximum": 10
            }
          }
        },
        "auto_create": {
          "type": "boolean",
          "description": "Automatically create ADRs without user consent (NOT RECOMMENDED)",
          "default": false
        }
      }
    },
    "implementation": {
      "type": "object",
      "description": "Implementation phase configuration",
      "properties": {
        "test_strategy": {
          "type": "string",
          "description": "Testing approach during implementation",
          "enum": ["tdd", "test-after", "no-tests"],
          "default": "tdd"
        },
        "test_coverage_threshold": {
          "type": "number",
          "description": "Minimum test coverage percentage required (0-100)",
          "default": 80,
          "minimum": 0,
          "maximum": 100
        },
        "pause_on_test_failure": {
          "type": "boolean",
          "description": "Pause pipeline if tests fail during implementation",
          "default": true
        },
        "pause_on_task_completion": {
          "type": "boolean",
          "description": "Pause for user approval after each task completes",
          "default": false
        }
      }
    },
    "reporting": {
      "type": "object",
      "description": "Pipeline reporting and observability",
      "properties": {
        "generate_phr": {
          "type": "boolean",
          "description": "Automatically generate PHR after pipeline completion",
          "default": true
        },
        "phr_stage": {
          "type": "string",
          "description": "PHR stage for pipeline execution records",
          "default": "misc"
        },
        "verbose_output": {
          "type": "boolean",
          "description": "Show detailed phase-by-phase output",
          "default": true
        },
        "execution_report": {
          "type": "boolean",
          "description": "Generate final execution report with timeline and artifacts",
          "default": true
        }
      }
    },
    "project": {
      "type": "object",
      "description": "Project-specific metadata (for cross-project portability)",
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name",
          "examples": ["todo-app", "ecommerce-platform"]
        },
        "tech_stack": {
          "type": "array",
          "description": "Primary technologies used (for context loading)",
          "items": {
            "type": "string"
          },
          "examples": [["Python", "pytest"], ["TypeScript", "React", "Jest"]]
        },
        "constitution_path": {
          "type": "string",
          "description": "Path to project constitution (relative to repo root)",
          "default": ".specify/memory/constitution.md"
        },
        "templates_dir": {
          "type": "string",
          "description": "Path to templates directory (relative to repo root)",
          "default": ".specify/templates"
        },
        "specs_dir": {
          "type": "string",
          "description": "Path to specifications directory (relative to repo root)",
          "default": "specs"
        }
      }
    }
  },
  "additionalProperties": false
}
